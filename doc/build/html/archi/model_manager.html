<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Model Manager &mdash; Voozanoo4 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/epiconcept.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Voozanoo4 1.0 documentation" href="../index.html" />
    <link rel="up" title="Architecture" href="../architecture.html" />
    <link rel="next" title="Noyau" href="noyau.html" />
    <link rel="prev" title="Mainframe" href="mainframe.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="noyau.html" title="Noyau"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mainframe.html" title="Mainframe"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Voozanoo4 1.0 documentation</a> &raquo;</li>
          <li><a href="../architecture.html" accesskey="U">Architecture</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="model-manager">
<span id="id1"></span><h1>Model Manager<a class="headerlink" href="#model-manager" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Le model manager sert à interagir avec la base de données. C&#8217;est par exemple le model manager qui génère les dataset à partir de leur description (dataquery).</p>
</div>
<div class="section" id="gestion-des-dataset">
<h2>Gestion des dataset<a class="headerlink" href="#gestion-des-dataset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Introduction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>A partir d&#8217;une description de dataset (dataquery), le ModelManager produit un DataSet.
Le ModelManager peut aussi prendre en paramètre un dataset pour sauvegarder des données en base (par exemple le contenu d&#8217;un formulaire).</p>
</div>
<div class="section" id="diagramme-de-class-d-un-dataset">
<h3>Diagramme de class d&#8217;un dataset<a class="headerlink" href="#diagramme-de-class-d-un-dataset" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/diagramme_dataset.png" src="../_images/diagramme_dataset.png" />
</div>
<div class="section" id="differents-resultats-a-partir-d-un-dataquery">
<h3>Différents résultats à partir d&#8217;un DataQuery<a class="headerlink" href="#differents-resultats-a-partir-d-un-dataquery" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/exemple_dataset1.png" src="../_images/exemple_dataset1.png" />
</div>
<div class="section" id="affichage-du-resultat-d-une-analyse">
<h3>Affichage du résultat d&#8217;une analyse<a class="headerlink" href="#affichage-du-resultat-d-une-analyse" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/exemple_dataset2.png" src="../_images/exemple_dataset2.png" />
</div>
<div class="section" id="affichage-d-un-formulaire">
<h3>Affichage d&#8217;un formulaire<a class="headerlink" href="#affichage-d-un-formulaire" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/exemple_dataset3.png" src="../_images/exemple_dataset3.png" />
<img alt="../_images/exemple_dataset4.png" src="../_images/exemple_dataset4.png" />
</div>
<div class="section" id="enregistrement-d-un-dataset">
<h3>Enregistrement d&#8217;un dataset<a class="headerlink" href="#enregistrement-d-un-dataset" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cinetique">
<h4>Cinétique<a class="headerlink" href="#cinetique" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/save_dataset.png" src="../_images/save_dataset.png" />
<ul>
<li><p class="first">La class MetaData vérifie la cohérence de la structure du dataset par rapport aux données existantes dans le projet (ex: comparaison avec le contenu des varset)</p>
</li>
<li><dl class="first docutils">
<dt>La class RowData sauvegarde</dt>
<dd><ul class="first last simple">
<li>Gestion des droits</li>
<li>Test des types</li>
<li>Lancement des tests de cohérence</li>
<li>Insert / Update (utilsiation du mode transactionnel pour l&#8217;enregistrement d&#8217;un dataset)</li>
<li>Historisation des modifications</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="generation-de-cles-primaires-cote-client">
<h4>Génération de clés primaires coté client<a class="headerlink" href="#generation-de-cles-primaires-cote-client" title="Permalink to this headline">¶</a></h4>
<p>Lorsque le dataset est envoyé par le module formulaire, il peut contenir des clés primaires générées par le javascript.
Elles sont listées dans le dataset dans la partie qui se nomme clientdata.
Ainsi le serveur connait les clés qui doivent être recréés par le moteur de base de données. Les nouvelles clés devront être renvoyées au client.</p>
</div>
<div class="section" id="indiquer-au-serveur-les-champs-modifies">
<h4>Indiquer au serveur les champs modifiés<a class="headerlink" href="#indiquer-au-serveur-les-champs-modifies" title="Permalink to this headline">¶</a></h4>
<p>Actuellement le dataset (en particulier le rowdata) ne contient pas d&#8217;information qui permet de dire si la donnée a changé ou non. Ainsi lors du commit du dataset on est obligé de tout sauvegarder.
Nous devons mettre une information dans le rowdata pour indiquer au système quelles sont les données à sauvegarder (ou à ajouter).</p>
<p>Forme actuelle du RowData:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;rowdata&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;28.74&quot;</span> <span class="na">id_data=</span><span class="s">&quot;6&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1989-04-17&quot;</span> <span class="na">nom=</span><span class="s">&quot;Seldon&quot;</span> <span class="na">prenom=</span><span class="s">&quot;Harry&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;50.29&quot;</span> <span class="na">id_data=</span><span class="s">&quot;7&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1973-08-23&quot;</span> <span class="na">nom=</span><span class="s">&quot;Vincent&quot;</span> <span class="na">prenom=</span><span class="s">&quot;David&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;6&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/rowdata&gt;</span>
</pre></div>
</div>
<p>Proposition:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;rowdata&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;28.74&quot;</span> <span class="na">id_data=</span><span class="s">&quot;6&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1989-04-17&quot;</span> <span class="na">nom=</span><span class="s">&quot;Seldon&quot;</span> <span class="na">prenom=</span><span class="s">&quot;Harry&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;5&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;nom&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;prenom&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/row&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;50.29&quot;</span> <span class="na">id_data=</span><span class="s">&quot;7&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1973-08-23&quot;</span> <span class="na">nom=</span><span class="s">&quot;Vincent&quot;</span> <span class="na">prenom=</span><span class="s">&quot;David&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;6&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;relation&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/row&gt;</span>
<span class="nt">&lt;/rowdata&gt;</span>
</pre></div>
</div>
<p>On pourrait même ajouter un log des modifications:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;rowdata&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;28.74&quot;</span> <span class="na">id_data=</span><span class="s">&quot;6&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1989-04-17&quot;</span> <span class="na">nom=</span><span class="s">&quot;Seldon&quot;</span> <span class="na">prenom=</span><span class="s">&quot;Harry&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;5&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;nom&quot;</span> <span class="na">old=</span><span class="s">&quot;NULL&quot;</span> <span class="na">new=</span><span class="s">&quot;Seldon&quot;</span> <span class="na">date=</span><span class="s">&quot;2010-06-30 11:00:03&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;prenom&quot;</span> <span class="na">old=</span><span class="s">&quot;NULL&quot;</span> <span class="na">new=</span><span class="s">&quot;John&quot;</span> <span class="na">date=</span><span class="s">&quot;2010-06-30 11:00:30&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;prenom&quot;</span> <span class="na">old=</span><span class="s">&quot;John&quot;</span> <span class="na">new=</span><span class="s">&quot;Harry&quot;</span> <span class="na">date=</span><span class="s">&quot;2010-06-30 11:00:37&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/row&gt;</span>
        <span class="nt">&lt;row</span> <span class="na">age=</span><span class="s">&quot;50.29&quot;</span> <span class="na">id_data=</span><span class="s">&quot;7&quot;</span> <span class="na">ddn=</span><span class="s">&quot;1973-08-23&quot;</span> <span class="na">nom=</span><span class="s">&quot;Vincent&quot;</span> <span class="na">prenom=</span><span class="s">&quot;David&quot;</span> <span class="na">sexe=</span><span class="s">&quot;1&quot;</span> <span class="na">dcontact=</span><span class="s">&quot;2010-03-01&quot;</span> <span class="na">relation=</span><span class="s">&quot;6&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modified</span> <span class="na">field=</span><span class="s">&quot;relation&quot;</span> <span class="na">old=</span><span class="s">&quot;NULL&quot;</span> <span class="na">new=</span><span class="s">&quot;6&quot;</span> <span class="na">date=</span><span class="s">&quot;2010-06-30 11:01:34&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/row&gt;</span>
<span class="nt">&lt;/row&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="gestion-des-variables-multiples">
<h4>Gestion des variables multiples<a class="headerlink" href="#gestion-des-variables-multiples" title="Permalink to this headline">¶</a></h4>
<p>Les variables multiples sont représentées sous forme de cases à cocher sur le formulaire, il s&#8217;agit de pouvoir définir plusieurs valeurs pour une même variable.
Exemple: il est possible de déclarer plusieurs traitements pour un patient.
Dans voozanoo3 ces variables sont stockées dans une table dédiée, dans Voozanoo4, chaque variable est reliée à une table de jointure.
Le type de ces variables est fkey_dico_ext. Il existe aussi le type fkey_varset_ext qui permet de faire une jointure entre deux varsets, il reste à spécifier.</p>
<p><strong>Entrées/Sorties</strong></p>
<p>Référence dans le XML dataquery.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;column_simple</span> <span class="na">field_name=</span><span class="s">&quot;ttt&quot;</span> <span class="na">table_name=</span><span class="s">&quot;p&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Définition dans le XML dataset:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;mutiple</span> <span class="na">name=</span><span class="s">&quot;ttt&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;value&gt;</span>37<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;value&gt;</span>38<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;value&gt;</span>40<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/multiple&gt;</span>
</pre></div>
</div>
<p>Sortie JSON:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="s2">&quot;rowdata&quot;</span><span class="o">:</span>
<span class="p">[</span>
        <span class="p">{</span>
                <span class="s2">&quot;id_data&quot;</span><span class="o">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ttt&quot;</span><span class="o">:</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
                <span class="s2">&quot;nom&quot;</span><span class="o">:</span><span class="s2">&quot;Arc&quot;</span>
        <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Traitement dans le ModelManager</strong></p>
<p>Il y a deux traitements possibles:</p>
<p>1- Première solution, la seconde requête</p>
<p>Description du fonctionnement standard du dataquery: le dataquery est transformé en requête SQL pour permettre de créer le dataset.
Cette requête est lancée lorsqu&#8217;on accède à une variable via la méthode Field de l&#8217;objet DataSet.
Pour les variables de type fkey_dico_ext, le fonctionnement est différent.
Elles ne sont pas récupérées dans la requête SQL, mais via une seconde requête qui permet de récupérer les données du varset qui sert de jointure avec le dictionnaire.
Cette requête est lancée lorsqu&#8217;on accède à la variable.</p>
<img alt="../_images/relations_n_n_v3_2.png" src="../_images/relations_n_n_v3_2.png" />
<p>On pourrait créer un dataquery générer la seconde requête:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;dataquery</span> <span class="na">id=</span><span class="s">&quot;pat_ttt&quot;</span> <span class="na">table_name=</span><span class="s">&quot;e5ib_01_dico_ttt&quot;</span> <span class="na">varset_name=</span><span class="s">&quot;pat_ttt&quot;</span> <span class="na">table_alias=</span><span class="s">&quot;pat_ttt&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;column_simple</span> <span class="na">field_name=</span><span class="s">&quot;id_pat&quot;</span> <span class="na">table_name=</span><span class="s">&quot;pat_ttt&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;column_simple</span> <span class="na">field_name=</span><span class="s">&quot;id_dico&quot;</span> <span class="na">table_name=</span><span class="s">&quot;pat_ttt&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;condition</span> <span class="na">sql=</span><span class="s">&quot;{id_patient}={id_dico_pat}&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">field_name=</span><span class="s">&quot;id_pat&quot;</span> <span class="na">table_name=</span><span class="s">&quot;pat_ttt&quot;</span> <span class="na">alias=</span><span class="s">&quot;id_dico_pat&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;variable</span> <span class="na">alias=</span><span class="s">&quot;id_patient&quot;</span> <span class="na">default=</span><span class="s">&quot;NULL&quot;</span> <span class="na">target_column=</span><span class="s">&quot;id_patient&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;entry</span> <span class="na">type=</span><span class="s">&quot;dataset&quot;</span> <span class="na">name=</span><span class="s">&quot;patient&quot;</span> <span class="na">field=</span><span class="s">&quot;id_data&quot;</span> <span class="na">row=</span><span class="s">&quot;current&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/variable&gt;</span>
        <span class="nt">&lt;/condition&gt;</span>
<span class="nt">&lt;/dataquery&gt;</span>
</pre></div>
</div>
<p>2- Seconde solution, la sous-requête</p>
<p>La solution précédente ne convient dans le cadre de l&#8217;utilisation de la variable fkey_dico_ext avec d&#8217;autres variables, et/ou avec des fonctions de transformation et de comparaison.
Cela est possible dans le dataquery, mais c&#8217;est un cas rare. Cependant est toujours vrai dans les tests de cohérence.</p>
<p>Exemple d&#8217;un dataquery test de cohérence: le variable traitement de type fkey_dico_ext provoque une erreur de cohérence si le traitement qui a pour identifiant 42 est dans la variable ttt.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;column</span> <span class="na">sql=</span><span class="s">&quot;42 not in {ttt}&quot;</span> <span class="na">alias=</span><span class="s">&quot;result&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">field_name=</span><span class="s">&quot;ttt&quot;</span> <span class="na">table_name=</span><span class="s">&quot;p&quot;</span> <span class="na">alias=</span><span class="s">&quot;ttt&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/column&gt;</span>
</pre></div>
</div>
<p>Pour supporter ce type de fonctionnement, il faut utiliser une sous-requête. Ainsi on peut récupérer toutes les données d&#8217;une variable fkey_dico_ext pour les exploiter dans la requête initiale du dataquery.
Exemple de requête SQL qui pourrait être générée pour le test de cohérence ci-dessus:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="mi">42</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">value</span> <span class="k">from</span> <span class="n">e5ib_01_dico_ttt_data</span>
<span class="k">where</span> <span class="n">e5ib_01_dico_ttt_data</span><span class="p">.</span><span class="n">id_data</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="n">id_data</span><span class="p">)</span> <span class="k">from</span> <span class="n">e5ib_01_data</span> <span class="k">as</span> <span class="n">p</span> <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">id_data</span><span class="o">=</span><span class="mi">4224</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Switch d&#8217;un mode à l&#8217;autre</strong></p>
<p>Le premier système (seconde requête) a l&#8217;avantage d&#8217;être mieux optimisé par rapport au second. Cependant il est insuffisant dès lors qu&#8217;on souhaite effectuer des traitements poussés.
Dans ce cas il faut passer au seconde mode (sous-requête).
Le passage d&#8217;un mode à l&#8217;autre doit se faire par l&#8217;analyse de la partie SQL de la colonne.
Mode seconde requête si l&#8217;attribut SQL est égale au nom de l&#8217;alias:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;column</span> <span class="na">sql=</span><span class="s">&quot;{ttt}&quot;</span> <span class="na">alias=</span><span class="s">&quot;ttt&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">field_name=</span><span class="s">&quot;ttt&quot;</span> <span class="na">table_name=</span><span class="s">&quot;p&quot;</span> <span class="na">alias=</span><span class="s">&quot;ttt&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/column&gt;</span>
</pre></div>
</div>
<p>Dans le cas contraire, on passe en mode sous-requête:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;column</span> <span class="na">sql=</span><span class="s">&quot;42 not in {ttt}&quot;</span> <span class="na">alias=</span><span class="s">&quot;result&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">field_name=</span><span class="s">&quot;ttt&quot;</span> <span class="na">table_name=</span><span class="s">&quot;p&quot;</span> <span class="na">alias=</span><span class="s">&quot;ttt&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/column&gt;</span>
</pre></div>
</div>
<p>Il doit être possible d&#8217;utiliser les deux modes en même temps dans un dataquery.</p>
</div>
</div>
</div>
<div class="section" id="les-parametres-alteres">
<span id="model-manager-alteredparameters"></span><h2>Les &#8220;Paramètres altérés&#8221;<a class="headerlink" href="#les-parametres-alteres" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>(Disponible depuis la révision 1902 du 02/05/2013).</p>
<p class="last">Cette fonctionnalité est réservée aux développeurs et est propre au noyau de Voo4.</p>
</div>
<div class="section" id="principe">
<h3>Principe<a class="headerlink" href="#principe" title="Permalink to this headline">¶</a></h3>
<p>Schématiquement lorsque le ModelManager détecte une ou plusieurs balises &#8220;<code class="docutils literal"><span class="pre">&lt;condition&gt;</span></code>&#8221; dans un DataQuery il les évalue en utilisant la classe
<code class="docutils literal"><span class="pre">Core_Library_Resource_XML_DataQuery_Params</span></code> pour récupérer la valeur réelle du paramètre à utiliser.</p>
<p>Cette classe intégère maintenant la notion de &#8220;Paramètre altéré&#8221; : si le paramètre demandé est détecté comme étant un de ces paramètres le &#8220;getter&#8221;
approrié sera appelé afin d&#8217;injecter une logique plus complexe qu&#8217;un simple getter.</p>
</div>
<div class="section" id="liste-des-parametres-alteres-reconnus">
<h3>Liste des paramètres altérés reconnus<a class="headerlink" href="#liste-des-parametres-alteres-reconnus" title="Permalink to this headline">¶</a></h3>
<div class="section" id="group-tree-ce-groupe-et-ses-enfants">
<h4><code class="docutils literal"><span class="pre">group_tree</span></code> - Ce groupe et ses enfants<a class="headerlink" href="#group-tree-ce-groupe-et-ses-enfants" title="Permalink to this headline">¶</a></h4>
<p>La détection de se paramètre occasionne l&#8217;appel au getter <code class="docutils literal"><span class="pre">getParamGroupTree</span></code> en charge de retourner un tableau contenant l&#8217;identifiant
du groupe sélectionné ainsi que les identifiants de tous ses fils.</p>
<p>Cela permet, dans des interfaces complexes, de proposer à l&#8217;utilisateur la sélection d&#8217;un groupe en tant que critère de filtrage et
d&#8217;inclure dans les résultats les fiches correspondant à ce groupe et tous ses enfants.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Le développeur doit anticiper ce comportement lors de l&#8217;utilisation du paramètre altéré <code class="docutils literal"><span class="pre">group_tree</span></code> : le retour d&#8217;un tableau d&#8217;identifiants.</p>
<p>Il doit donc écrire son fragment SQL en conséquence, avec un IN :</p>
<div class="last highlight-xml"><div class="highlight"><pre><span class="nt">&lt;condition</span> <span class="na">sql=</span><span class="s">&quot;{gl.id_group_parent} IN ({param_id_group})&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;field</span> <span class="na">field_name=</span><span class="s">&quot;id_group_parent&quot;</span> <span class="na">alias=</span><span class="s">&quot;gl.id_group_parent&quot;</span> <span class="na">table_name=</span><span class="s">&quot;gl&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;variable</span> <span class="na">alias=</span><span class="s">&quot;param_id_group&quot;</span> <span class="na">default=</span><span class="s">&quot;null&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">type=</span><span class="s">&quot;param&quot;</span> <span class="na">name=</span><span class="s">&quot;group_tree&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">type=</span><span class="s">&quot;dataset&quot;</span> <span class="na">name=</span><span class="s">&quot;filter&quot;</span> <span class="na">row=</span><span class="s">&quot;current&quot;</span> <span class="na">field=</span><span class="s">&quot;group_tree&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/variable&gt;</span>
<span class="nt">&lt;/condition&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ajout-de-parametre-altere">
<h3>Ajout de paramètre altéré<a class="headerlink" href="#ajout-de-parametre-altere" title="Permalink to this headline">¶</a></h3>
<p>Pour ajouter un paramètre altéré il faut :</p>
<ul>
<li><dl class="first docutils">
<dt>L&#8217;ajouter dans l&#8217;attribut protected <code class="docutils literal"><span class="pre">$_aAlteredParams</span></code>, exemple :</dt>
<dd><div class="first last highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">protected</span> <span class="nv">$_aAlteredParams</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;group_tree&#39;</span><span class="p">,</span> <span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Définir la méthode qui fera office de &#8220;getter&#8221; pour le paramètre altéré, exemple :</dt>
<dd><div class="first last highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">getParamFooBar</span><span class="p">(</span> <span class="nv">$sOriginalParamName</span> <span class="p">)</span>
<span class="p">{</span>
        <span class="c1">//Logic pour retourner le paramètre demandé</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Le getter reçoit systématiquement un paramètre <code class="docutils literal"><span class="pre">$sOriginalParamName</span></code> qui est une String représent le nom du paramètre d&#8217;origine.</p>
<p>Dans le cas d&#8217;un paramètre altéré natif &#8220;foo_bar&#8221; ou &#8220;group_tree&#8221; ce paramètre vaudra respectivement &#8220;foo_bar&#8221; et &#8220;group_tree&#8221;. Cependant l&#8217;utilisateur peut utilisé un &#8220;Alias de paramètre altéré&#8221;
pour lié un paramètre &#8220;azerty&#8221; au comportement du paramètre altéré &#8220;groupe_tree&#8221;.</p>
<p class="last">Ce comportement sera rarement implémenté mais est permis, voir les détails ci-dessous.</p>
</div>
</div>
<div class="section" id="ajout-d-un-alias-de-parametre-altere">
<h3>Ajout d&#8217;un Alias de paramètre altéré<a class="headerlink" href="#ajout-d-un-alias-de-parametre-altere" title="Permalink to this headline">¶</a></h3>
<p>Le développeur peut spécifier un Alias de paramètre altéré pour faire pointer un paramètre qu&#8217;il nomme &#8220;dummy&#8221; vers le comportement spécifique du paramètre &#8220;group_tree&#8221;.</p>
<p>Pour ce faire il doit exploiter les Points d&#8217;accès (Voir <a class="reference internal" href="frame.html#hooks"><em>Points d&#8217;accès (Hook / Events)</em></a>) et en particulier celui lié au getDataset : <code class="docutils literal"><span class="pre">_getdataset_beforeExecute</span></code>.</p>
<p>Ce dernier dispose, dans son contexte, de la clé <code class="docutils literal"><span class="pre">'aParams'</span></code> contenant un array de paramètres fournis en HTTP Get. Le développeur peut à loisir
transformer ce tableau de paramètre en objet <code class="docutils literal"><span class="pre">Core_Library_Resource_XML_DataQuery_Params</span></code> afin d&#8217;indiquer un alias via :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$oParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Core_Library_Resource_XML_DataQuery_Params</span><span class="p">(</span> <span class="nv">$oDataQuery</span><span class="p">,</span> <span class="nv">$aParams</span> <span class="p">);</span>
<span class="nv">$oParams</span><span class="o">-&gt;</span><span class="na">AddAliasAlteredParameter</span><span class="p">(</span><span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="s1">&#39;group_tree&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Model Manager</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#gestion-des-dataset">Gestion des dataset</a><ul>
<li><a class="reference internal" href="#id2">Introduction</a></li>
<li><a class="reference internal" href="#diagramme-de-class-d-un-dataset">Diagramme de class d&#8217;un dataset</a></li>
<li><a class="reference internal" href="#differents-resultats-a-partir-d-un-dataquery">Différents résultats à partir d&#8217;un DataQuery</a></li>
<li><a class="reference internal" href="#affichage-du-resultat-d-une-analyse">Affichage du résultat d&#8217;une analyse</a></li>
<li><a class="reference internal" href="#affichage-d-un-formulaire">Affichage d&#8217;un formulaire</a></li>
<li><a class="reference internal" href="#enregistrement-d-un-dataset">Enregistrement d&#8217;un dataset</a><ul>
<li><a class="reference internal" href="#cinetique">Cinétique</a></li>
<li><a class="reference internal" href="#generation-de-cles-primaires-cote-client">Génération de clés primaires coté client</a></li>
<li><a class="reference internal" href="#indiquer-au-serveur-les-champs-modifies">Indiquer au serveur les champs modifiés</a></li>
<li><a class="reference internal" href="#gestion-des-variables-multiples">Gestion des variables multiples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#les-parametres-alteres">Les &#8220;Paramètres altérés&#8221;</a><ul>
<li><a class="reference internal" href="#principe">Principe</a></li>
<li><a class="reference internal" href="#liste-des-parametres-alteres-reconnus">Liste des paramètres altérés reconnus</a><ul>
<li><a class="reference internal" href="#group-tree-ce-groupe-et-ses-enfants"><code class="docutils literal"><span class="pre">group_tree</span></code> - Ce groupe et ses enfants</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ajout-de-parametre-altere">Ajout de paramètre altéré</a></li>
<li><a class="reference internal" href="#ajout-d-un-alias-de-parametre-altere">Ajout d&#8217;un Alias de paramètre altéré</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mainframe.html"
                        title="previous chapter">Mainframe</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="noyau.html"
                        title="next chapter">Noyau</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/archi/model_manager.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="noyau.html" title="Noyau"
             >next</a> |</li>
        <li class="right" >
          <a href="mainframe.html" title="Mainframe"
             >previous</a> |</li>
        <li><a href="../index.html">Voozanoo4 1.0 documentation</a> &raquo;</li>
          <li><a href="../architecture.html" >Architecture</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, Epiconcept.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>